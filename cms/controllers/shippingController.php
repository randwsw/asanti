<?php 
if(!session_id()){
	session_start();
} 
if(isset($_SESSION['log']) && $_SESSION['status'] == "adm") {

}else{
	header("Location: login.php");					
}


// Vars /////////////////////////////////////////////////////////////////////////////////////////////// //
$conn=mysqli_connect("serwer1309748.home.pl","serwer1309748_04","9!c3Q9","serwer1309748_04");

require_once '../../htmlpurifier/library/HTMLPurifier.auto.php';

$config = HTMLPurifier_Config::createDefault();
$purifier = new HTMLPurifier($config);

// //////////////////////////////////////////////////////////////////////////////////////////////////// //



$sql = "SET NAMES 'utf8'";
!mysqli_query($conn,$sql);


if (mysqli_connect_errno())
		  {
		  	echo "Failed to connect to MySQL: " . mysqli_connect_error();
		  }


$action = $_POST['action'];

switch ($action) {
	
	
	case "addNew":
	// ---------------------------------------------------------------------------------------------------------- //
	// ADD NEW SHIPPIN------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	$name2 = $conn->real_escape_string($_POST['newName']);
	$name2 = $purifier->purify($name2);
	
	$value = $_POST['newValue'];
	
	$aWhat = array('Ą', 'Ę', 'Ó', 'Ś', 'Ć', 'Ń', 'Ź', 'Ż', 'Ł', 'ą', 'ę', 'ó', 'ś', 'ć', 'ń', 'ź', 'ż', 'ł', ',', ' ');
	$aOn =    array('A', 'E', 'O', 'S', 'C', 'N', 'Z', 'Z', 'L', 'a', 'e', 'o', 's', 'c', 'n', 'z', 'z', 'l', '', '_');
	$name =  str_replace($aWhat, $aOn, $name2);
	
	$sql="INSERT INTO shipping (name, value, active)
		VALUES
		('$name','$value', '1')";
		
		if (!mysqli_query($conn,$sql))
		  {
			  die('Error: ' . mysqli_error($conn));
			  mysqli_close($conn);
		  }else
		  {
		  	mysqli_close($conn);
		  }
	header("Location: ../shipping.php");
	break;
		
	
	
	
	
	case "changeActive":
	// ---------------------------------------------------------------------------------------------------------- //
	// CHANGE ACTIVE -------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	
		$shipId = $_POST['shipId'];
		$active = $_POST['active'];
		
		mysqli_query($conn,"UPDATE shipping SET active=$active WHERE id='$shipId'");
	
		mysqli_close($conn);
	break;




	
	case "updateShip":
	// ---------------------------------------------------------------------------------------------------------- //
	// UPDATE SHIPPING ------------------------------------------------------------------------------------------ //
	// ---------------------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
	// ---------------------------------------------------------------------------------------------------------- //
		$shipId = $_POST['shipId'];
		
		$value = $conn->real_escape_string($_POST['value']);
		
		$name = $conn->real_escape_string($_POST['name']);
		$name = $purifier->purify($name);
		
		mysqli_query($conn,"UPDATE shipping SET name = '$name', value = '$value' WHERE id='$shipId'");
	
		mysqli_close($conn);
	break;
	
	
	
	
	
	case "deleteShip":
		// ---------------------------------------------------------------------------------------------------------- //
		// DELETE SHIP ---------------------------------------------------------------------------------------------- //
		// ---------------------------------------------------------------------------------------------------------- //
		// ---------------------------------------------------------------------------------------------------------- //
		// ---------------------------------------------------------------------------------------------------------- //
		$id = $_POST['shipId'];
	
	  	
	  	$sql="DELETE FROM shipping
				WHERE id = '$id'";
		if (!mysqli_query($conn,$sql))
		{
		  	die('Error: ' . mysqli_error($conn));
		  	mysqli_close($conn);
		  }else
		  	{
		  	echo("success");
			mysqli_close($conn);
		  }
	  	
		break;
}


?>